import protos from"./mods/protos.min.js";import utils from"./mods/utils.min.js";import common from"./mods/common.min.js";import cart from"./mods/cart.min.js";import Zoom from"./mods/zoom.min.js";import Figure from"./mods/figure.min.js";import math from"./mods/math.min.js";const MM={},content=document.getElementById("creator-content"),pageOrientations=["portrait","paysage"],parameters={};let fontSize="1";function refresh(){makePage(),common.mathRender(["question","answer"])}function fontSizePlus(){fontSize*=1.25,content.style["font-size"]=fontSize+"em"}function fontSizeMinus(){fontSize*=.8,content.style["font-size"]=fontSize+"em"}function getRandomPastelColor(){return"hsl("+360*Math.random()+","+(25+70*Math.random())+"%,"+(85+10*Math.random())+"%)"}function makePage(){parameters.alea&&common.setSeed(parameters.alea),content.innerHTML="",MM.memory={},common.generateQuestions(parameters);let nbOfCards=0;for(const[index,activity]of parameters.cart.activities.entries())for(let j=0;j<activity.questions.length;j++){nbOfCards++;const colorCard=getRandomPastelColor(),container=utils.create("article",{className:"tuile"}),flipCardInner=utils.create("div",{className:"flip-card-inner"}),randomColor=Math.floor(16777215*Math.random()).toString(16),artQuestion=utils.create("div",{className:"question flip-card-front"});artQuestion.style.backgroundColor=colorCard;const buttonSolution=utils.create("div",{className:"interrogation",innerText:"?",title:"Cliquer pour afficher la correction"});buttonSolution.style["border-bottom"]="0.3rem solid "+colorCard,buttonSolution.style["border-right"]="0.3rem solid "+colorCard;const divq=utils.create("div");activity.consigne&&divq.appendChild(utils.create("div",{innerHTML:"<i>"+activity.consigne+"</i>"}));const artCorrection=utils.create("div",{className:"answer flip-card-back"});artCorrection.style.backgroundColor=colorCard,buttonSolution.onclick=()=>{flipCardInner.classList.toggle("rotate")};const divr=utils.create("div");if("latex"===activity.type||""===activity.type||void 0===activity.type){const span=utils.create("span",{className:"math",innerHTML:activity.questions[j]}),spanCorrection=utils.create("span",{className:"math",innerHTML:activity.answers[j]});divq.appendChild(span),divr.appendChild(spanCorrection)}else divq.innerHTML=activity.questions[j],divr.innerHTML=activity.answers[j];artQuestion.appendChild(divq),flipCardInner.appendChild(artQuestion),void 0!==activity.figures[j]&&(MM.memory["f"+index+"-"+j]=new Figure(utils.clone(activity.figures[j]),"f"+index+"-"+j,divq)),artCorrection.appendChild(divr),flipCardInner.appendChild(artCorrection),container.appendChild(flipCardInner),container.appendChild(utils.create("div",{className:"numero",innerText:nbOfCards})),container.appendChild(buttonSolution),content.appendChild(container)}utils.isEmpty(MM.memory)||setTimeout((function(){for(const k in MM.memory)"dest"!==k&&MM.memory[k].display()}),300)}function checkURL(urlString){const vars=utils.getUrlVars(urlString);if(void 0!==vars.embed){let expression,regex=new RegExp(/(https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9]+\.[^\s]{2,}|www\.[a-zA-Z0-9]+\.[^\s]{2,})/gi);vars.embed.match(regex)&&(MM.embededIn=vars.embed)}if(void 0!==vars.c){vars.a?parameters.alea=vars.a:parameters.alea=common.setSeed();let json=vars.c;parameters.titreFiche=decodeURI(vars.t),parameters.cart=new cart(0),parameters.cart.import(json[0],!1).then(()=>{refresh()}).catch(err=>{let stack=err.stack.split("\n");stack.splice(0,2);let alert=utils.create("div",{id:"messageerreur",className:"message",innerHTML:"Impossible de charger le panier :(<br>"+err+"<br>"+stack});console.log(err.stack),document.getElementById("creator-content").appendChild(alert)})}}document.getElementById("flipall").onclick=()=>{let rotate=!0;const elements=document.querySelectorAll(".flip-card-inner"),nbOfElements=elements.length;let count=0;elements.forEach(el=>{el.classList.contains("rotate")&&count++}),elements.forEach(el=>{count<nbOfElements?el.classList.add("rotate"):el.classList.remove("rotate")})},document.getElementById("zoomin").onclick=()=>{fontSizePlus()},document.getElementById("zoomout").onclick=()=>{fontSizeMinus()},checkURL();